diff -ipuwr -x config.log -x config.status -x config.cache -x '*.Po' -x '*.pot' -x '*.bak' -x '*.orig' -x '*.rej' -x '*.new' -x '*~' -x '*.o' -x '*.exe' -x patches -x '*.dll' -x'*.la' -x res -x debian -x '*.log' -x '*.lib' -x'*.a' -x .libs -x'*.def' -x'*.uu' -x'*.rc' -x'*.ico' -x'*.lo' bzip2-1.0.5-orig/Makefile bzip2-1.0.5/Makefile
--- bzip2-1.0.5-orig/Makefile	2008-02-14 13:39:18.000000000 +0100
+++ bzip2-1.0.5/Makefile	2008-03-20 20:05:47.015625000 +0100
@@ -12,19 +12,33 @@
 # in the file LICENSE.
 # ------------------------------------------------------------------
 
+VERSION = 1.0.4
+MAJOR=$(shell echo $(VERSION) | sed -e "s/\..*$$//")
+MINOR=$(shell echo $(VERSION) | sed -e "s/^[^\.]*\.0*\([0-9]\+\).*$$/\1/")
+VERSADD = -Wl,--major-image-version=$(MAJOR) -Wl,--minor-image-version=$(MINOR) 
 SHELL=/bin/sh
+RESDIR=./resource
+VPATH=. $(RESDIR)
 
 # To assist in cross-compiling
 CC=gcc
 AR=ar
 RANLIB=ranlib
-LDFLAGS=
-
-BIGFILES=-D_FILE_OFFSET_BITS=64
-CFLAGS=-Wall -Winline -O2 -g $(BIGFILES)
+LDFLAGS= -Wl,-s $(VERSADD)
+EXE_EXT=.exe
+DLL_EXT=.dll
+LN=cp -fp
+  
+ # Suitably paranoid flags to avoid bugs in gcc-2.7
+BIGFILES = 
+CFLAGS = -Wall -Winline -O3 -fms-extensions -mms-bitfields \
+	-fno-exceptions -fomit-frame-pointer -march=i386 \
+	-ffast-math -fno-strength-reduce $(BIGFILES) \
+	-I. -ID:/progra~1/gnuwin32/lib 
+LIBS = -lole32 -luuid -liberty
 
 # Where you want it installed when you do 'make install'
-PREFIX=/usr/local
+PREFIX=c:/progra~1/Bzip2
 
 
 OBJS= blocksort.o  \
@@ -35,13 +49,24 @@ OBJS= blocksort.o  \
       decompress.o \
       bzlib.o
 
-all: libbz2.a bzip2 bzip2recover test
+DLLOBJS = $(OBJS) bzip-dllversion.o
+
+.SUFFIXES:
+.SUFFIXES: .c .o .exe .rc .dll 
+
+# Rule to make compiled resource (Windows)
+.rc.o:
+	windres --include-dir $(RESDIR) -i $< -o $@
 
-bzip2: libbz2.a bzip2.o
-	$(CC) $(CFLAGS) $(LDFLAGS) -o bzip2 bzip2.o -L. -lbz2
+all: bzip2$(DLL_EXT) bzip2 bzip2recover test
 
-bzip2recover: bzip2recover.o
-	$(CC) $(CFLAGS) $(LDFLAGS) -o bzip2recover bzip2recover.o
+bzip2: libbz2.a bzip2.o bzip2-res.o
+	$(CC) $(CFLAGS) $(LDFLAGS) -o bzip2 bzip2.o bzip2-res.o \
+		-L. -lbz2 $(LIBS)
+
+bzip2recover: bzip2recover.o bzip2recover-res.o
+	$(CC) $(CFLAGS) $(LDFLAGS) -o bzip2recover bzip2recover.o \
+		bzip2recover-res.o $(LIBS)
 
 libbz2.a: $(OBJS)
 	rm -f libbz2.a
@@ -52,6 +77,10 @@ libbz2.a: $(OBJS)
 		$(RANLIB) libbz2.a ; \
 	fi
 
+bzip2$(DLL_EXT): $(DLLOBJS)
+	-rm -f bzip2.def
+	o2dll -o $@ -l libbz2 $(DLLOBJS) -version-info 0:0:0 
+
 check: test
 test: bzip2
 	@cat words1
@@ -75,29 +104,30 @@ install: bzip2 bzip2recover
 	if ( test ! -d $(PREFIX)/man ) ; then mkdir -p $(PREFIX)/man ; fi
 	if ( test ! -d $(PREFIX)/man/man1 ) ; then mkdir -p $(PREFIX)/man/man1 ; fi
 	if ( test ! -d $(PREFIX)/include ) ; then mkdir -p $(PREFIX)/include ; fi
-	cp -f bzip2 $(PREFIX)/bin/bzip2
-	cp -f bzip2 $(PREFIX)/bin/bunzip2
-	cp -f bzip2 $(PREFIX)/bin/bzcat
-	cp -f bzip2recover $(PREFIX)/bin/bzip2recover
-	chmod a+x $(PREFIX)/bin/bzip2
-	chmod a+x $(PREFIX)/bin/bunzip2
-	chmod a+x $(PREFIX)/bin/bzcat
-	chmod a+x $(PREFIX)/bin/bzip2recover
-	cp -f bzip2.1 $(PREFIX)/man/man1
+	cp -fp bzip2 $(PREFIX)/bin/bzip2$(EXE_EXT)
+	cp -fp bzip2 $(PREFIX)/bin/bunzip2$(EXE_EXT)
+	cp -fp bzip2 $(PREFIX)/bin/bzcat$(EXE_EXT)
+	cp -fp bzip2$(DLL_EXT) $(PREFIX)/bin/bzip2$(DLL_EXT)
+	cp -fp bzip2recover $(PREFIX)/bin/bzip2recover$(EXE_EXT)
+	chmod a+x $(PREFIX)/bin/bzip2$(EXE_EXT)
+	chmod a+x $(PREFIX)/bin/bunzip2$(EXE_EXT)
+	chmod a+x $(PREFIX)/bin/bzcat$(EXE_EXT)
+	chmod a+x $(PREFIX)/bin/bzip2recover$(EXE_EXT)
+	cp -fp bzip2.1 $(PREFIX)/man/man1
 	chmod a+r $(PREFIX)/man/man1/bzip2.1
-	cp -f bzlib.h $(PREFIX)/include
+	cp -fp bzlib.h $(PREFIX)/include
 	chmod a+r $(PREFIX)/include/bzlib.h
-	cp -f libbz2.a $(PREFIX)/lib
+	cp -fp libbz2.a $(PREFIX)/lib
 	chmod a+r $(PREFIX)/lib/libbz2.a
-	cp -f bzgrep $(PREFIX)/bin/bzgrep
-	ln -s -f $(PREFIX)/bin/bzgrep $(PREFIX)/bin/bzegrep
-	ln -s -f $(PREFIX)/bin/bzgrep $(PREFIX)/bin/bzfgrep
+	cp -fp bzgrep $(PREFIX)/bin/bzgrep
+	cp -fp -f $(PREFIX)/bin/bzgrep $(PREFIX)/bin/bzegrep
+	cp -fp -f $(PREFIX)/bin/bzgrep $(PREFIX)/bin/bzfgrep
 	chmod a+x $(PREFIX)/bin/bzgrep
 	cp -f bzmore $(PREFIX)/bin/bzmore
-	ln -s -f $(PREFIX)/bin/bzmore $(PREFIX)/bin/bzless
+	cp -fp -f $(PREFIX)/bin/bzmore $(PREFIX)/bin/bzless
 	chmod a+x $(PREFIX)/bin/bzmore
 	cp -f bzdiff $(PREFIX)/bin/bzdiff
-	ln -s -f $(PREFIX)/bin/bzdiff $(PREFIX)/bin/bzcmp
+	cp -fp -f $(PREFIX)/bin/bzdiff $(PREFIX)/bin/bzcmp
 	chmod a+x $(PREFIX)/bin/bzdiff
 	cp -f bzgrep.1 bzmore.1 bzdiff.1 $(PREFIX)/man/man1
 	chmod a+r $(PREFIX)/man/man1/bzgrep.1
@@ -109,9 +139,10 @@ install: bzip2 bzip2recover
 	echo ".so man1/bzdiff.1" > $(PREFIX)/man/man1/bzcmp.1
 
 clean: 
-	rm -f *.o libbz2.a bzip2 bzip2recover \
+	rm -f *.o libbz2*.a bzip2$(EXE_EXT) bzip2recover$(EXE_EXT) bzip2$(DLL_EXT) \
 	sample1.rb2 sample2.rb2 sample3.rb2 \
-	sample1.tst sample2.tst sample3.tst
+	sample1.tst sample2.tst sample3.tst	 \
+	bzip2*.lib 
 
 blocksort.o: blocksort.c
 	@cat words0
@@ -140,7 +171,7 @@ distclean: clean
 DISTNAME=bzip2-1.0.5
 dist: check manual
 	rm -f $(DISTNAME)
-	ln -s -f . $(DISTNAME)
+	cp -fp -f . $(DISTNAME)
 	tar cvf $(DISTNAME).tar \
 	   $(DISTNAME)/blocksort.c \
 	   $(DISTNAME)/huffman.c \
@@ -176,7 +207,7 @@ dist: check manual
 	   $(DISTNAME)/README.COMPILATION.PROBLEMS \
 	   $(DISTNAME)/README.XML.STUFF \
 	   $(DISTNAME)/CHANGES \
-	   $(DISTNAME)/libbz2.def \
+	   $(DISTNAME)/bzip2.def \
 	   $(DISTNAME)/libbz2.dsp \
 	   $(DISTNAME)/dlltest.dsp \
 	   $(DISTNAME)/makefile.msc \
